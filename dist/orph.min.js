!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Orph=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=["props","state","render","update","dispatch"],o=Array.isArray,u=function(t){return"function"==typeof t},a=function e(n){return"object"!==(void 0===(i=n)?"undefined":t(i))||null===i?n:o(n)?n.map(function(t){return e(t)}):(r={},Object.keys(n).forEach(function(t){r[t]=e(n[t])}),r);var r,i},s=function(t,e){if(t)throw new Error(e)};return function(){function t(n){e(this,t),this._initialState=a(n),this._orphans=new Map,this._use={}}return n(t,[{key:"register",value:function(t,e){var n=this,o=e.use||{},u=Object.keys(o).filter(function(t){return-1!==i.indexOf(t)&&o[t]}),a=e.prefix;Object.entries(t).forEach(function(t){var e=r(t,2),i=e[0],o=e[1];return"function"==typeof o&&n._orphans.set(""+(a||"")+i,{orphan:o,useKeys:u})})}},{key:"order",value:function(){var t=this,e={};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(n){e[n]=function(e){return t.dispatch(n,e)}}),e}},{key:"dispatch",value:function(t,e){s(!this._orphans.has(t),t+" is not added"),e&&u(e.persist)&&e.persist();var n=this._orphans.get(t),r=n.orphan,i=n.useKeys,o=this._createUse(i);return Promise.resolve(r(e,o))}},{key:"_createUse",value:function(t){var e=this,n={};return t.forEach(function(t){n[t]=e._use[t]}),n}},{key:"attach",value:function(t){var e=this;s(!u(t.setState),"orph.attach must be passed react"),this._use.props=function(e,n){return n?t.props[e]:a(t.props[e])},this._use.state=function(e,n){return n?t.state[e]:a(t.state[e])},this._use.render=function(e,n){return t.setState(e,n)},this._use.update=function(e){return t.forceUpdate(e)},this._use.dispatch=function(t,n){return e.dispatch(t,n)},t.state=this._initialState,this._escapeState=function(){return t.state}}},{key:"detach",value:function(t){var e=this;this._initialState=t?this._escapeState():this._initialState,Object.keys(this._use).forEach(function(t){return delete e._use[t]}),delete this._escapeState}},{key:"list",value:function(){var t={};return[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(this._orphans.entries())).forEach(function(e){var n=r(e,2),i=n[0],o=n[1].useKeys;t[i]=o}),t}}]),t}()});
