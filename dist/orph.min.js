!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Orph=e()}(this,function(){"use strict";var t=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),e=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}var i=["props","state","render","update"],a=i.concat(["dispatch"]),o=Array.isArray,s=function t(e){return"object"!==(void 0===(i=e)?"undefined":r(i))||null===i?e:o(e)?e.map(function(e){return t(e)}):(n={},Object.keys(e).forEach(function(r){n[r]=t(e[r])}),n);var n,i},u=function(t){return"object"===(void 0===t?"undefined":r(t))&&!o(t)&&null!==t},c=function(t){return"function"==typeof t},f=function(t,e){if(!t)throw new Error(e)};return function(){function r(t){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),f(u(t),'Orph.prototype.constructor requires argument as "object" not others'),this._actions=new Map,this._initialState=s(t),this._use={dispatch:function(t,r){return e.dispatch(t,r)}}}return e(r,[{key:"register",value:function(e,r){var n=this;f(u(e),'Orph.prototype.register requires first argument as "object" not others'),f(u(r),'Orph.prototype.register requires second argument as "object" not others'),f(u(r.use),'Orph.prototype.register second argument requires "use" property as "object" not others');var i=r.prefix||"",o=a.filter(function(t){return!0===r.use[t]});Object.entries(e).forEach(function(e){var r=t(e,2),a=r[0],s=r[1];return c(s)&&n._actions.set(""+i+a,{useKeys:o,action:s})})}},{key:"order",value:function(t){var e=this;f(o(t)||!t,'Orph.prototype.order requires argument as "array"');var r={};return(t||[].concat(n(this._actions.keys()))).forEach(function(t){return r[t]=function(r){return e.dispatch(t,r)}}),r}},{key:"list",value:function(){var e={};return[].concat(n(this._actions.entries())).forEach(function(r){var n=t(r,2),i=n[0],a=n[1].useKeys;return e[i]=a}),e}},{key:"attach",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(c(t.setState),"orph.attach must be passed react"),this._escapeState=function(){return t.state},this._use.props=this._makeUseCancelable(function(e,r){return r?t.props[e]:s(t.props[e])}),this._use.state=this._makeUseCancelable(function(e,r){return r?t.state[e]:s(t.state[e])}),this._use.render=this._makeUseCancelable(function(e,r){return t.setState(e,r)}),this._use.update=this._makeUseCancelable(function(e){return t.forceUpdate(e)}),t.state=e.inherit?this._existState():this._initialState}},{key:"_makeUseCancelable",value:function(t){var e=this;return function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return new Promise(function(r,i){return e._isAttached()?r(t.apply(void 0,n)):i({isDetached:!0})})}}},{key:"detach",value:function(){var t=this;this._preState=this._escapeState(),delete this._escapeState,i.forEach(function(e){return delete t._use[e]})}},{key:"_existState",value:function(){return this._preState||this._initialState}},{key:"_isAttached",value:function(){return c(this._escapeState)}},{key:"dispatch",value:function(t,e){f(this._actions.has(t),"Orph.prototype.dispatch passed "+t+" as name that is not retisterd"),u(e)&&c(e.persist)&&e.persist();var r=this._actions.get(t),n=r.action,i=r.useKeys;try{var a=n(e,this._createUse(i));return Promise.resolve(a)}catch(t){return Promise.reject(t)}}},{key:"_createUse",value:function(t){var e=this,r={};return t.forEach(function(t){return r[t]=e._use[t]}),r}},{key:"getLatestState",value:function(t,e){var r=this._isAttached()?this._escapeState()[t]:this._existState()[t];return e?r:s(r)}}]),r}()});
