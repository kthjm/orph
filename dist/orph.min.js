!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Orph=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},o=Array.isArray,a=Object.assign,u=function(){function u(t){var r=this;return e(this,u),this._listeners=new Map,o(t)&&t.forEach(function(t){return r.add.apply(r,i(t))})}return r(u,[{key:"add",value:function(t,e,r){s(t,"string",'orph.add argument "name"'),s(e,"function",'orph.add argument "listener"');var n=r||{},i=n.states,o=n.dispatches,a=this._HoRender(i),u=this._HoDispatch(o);this._listeners.set(t,{listener:e,render:a,dispatch:u,list:{states:i,dispatches:o}})}},{key:"attach",value:function(t){s(t.setState,"function","react.setState"),s(t.forceUpdate,"function","react.forceUpdate"),this._reacts={setState:function(e,r){return t.setState(e,r)},update:function(e){return t.forceUpdate(e)},props:function(){return a({},t.props)},state:function(){return a({},t.state)}}}},{key:"detach",value:function(){this._reacts=null}},{key:"active",value:function(){return Boolean(this._reacts)}},{key:"create",value:function(t){var e=this;return s(t,"string",'orph.create argument "name"'),this._throwIfNotActive("create"),function(r){return e._exec(t,r)}}},{key:"dispatch",value:function(t,e){return s(t,"string",'orph.dispatch argument "name"'),this._throwIfNotActive("dispatch"),this._exec(t,e)}},{key:"_HoRender",value:function(e){var r=this;return o(e)?function(n,i){if("object"===(void 0===n?"undefined":t(n))){if(Object.keys(n).filter(function(t){return!(-1!==e.indexOf(t))}).length)throw new Error("methods.render touches stateName that is not registerd")}return r._reacts&&r._reacts.setState(n,i)}:function(t,e){return r._reacts&&r._reacts.setState(t,e)}}},{key:"_HoDispatch",value:function(t){var e=this;return o(t)?function(r,n){if(-1===t.indexOf(r))throw new Error("methods.dispatch touches dispatchName that is not registerd");return e._exec(r,n)}:function(t,r){return e._exec(t,r)}}},{key:"_exec",value:function(t,e){var r=this;return e&&"function"==typeof e.persist&&e.persist(),Promise.resolve().then(function(){return r._throwIfNotActive("_exec")}).then(function(){var n=r._listeners.get(t);if(!n)throw new Error("methods.dispatch name is not added");var i=n.listener,o=n.render,a=n.dispatch,u=r._reacts||{};return i(e,{render:o,dispatch:a,state:u.state,props:u.props,update:u.update})})}},{key:"_throwIfNotActive",value:function(t){if(!this.active())throw new Error("not active but "+t+"()")}},{key:"list",value:function(){var t={};return[].concat(i(this._listeners.entries())).forEach(function(e){var r=n(e,2),i=r[0],o=r[1];t[i]=o.list}),t}}]),u}(),s=function(e,r,n){if(!e)throw new Error(n+" is undefined | false | null");if((void 0===e?"undefined":t(e))!==r)throw new TypeError(n+" is not "+r+" but "+(void 0===e?"undefined":t(e)))};return u});
