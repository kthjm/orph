!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Orph=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},a=["props","state","render","update"],o=a.concat(["dispatch"]),s=Array.isArray,u=function e(r){return"object"!==(void 0===(i=r)?"undefined":t(i))||null===i?r:s(r)?r.map(function(t){return e(t)}):(n={},Object.keys(r).forEach(function(t){n[t]=e(r[t])}),n);var n,i},c=function(e){return"object"===(void 0===e?"undefined":t(e))&&!s(e)&&null!==e},f=function(t){return"function"==typeof t},h=function(t,e){if(t)throw new Error(e)};return function(){function t(r){var n=this;e(this,t),h(!c(r),'Orph.prototype.constructor requires argument as "object" not others'),this._actions=new Map,this._initialState=u(r),this._use={dispatch:function(t,e){return n.dispatch(t,e)}}}return r(t,[{key:"register",value:function(t,e){var r=this;h(!c(t),'Orph.prototype.register requires first argument as "object" not others'),h(!c(e),'Orph.prototype.register requires second argument as "object" not others'),h(!c(e.use),'Orph.prototype.register second argument requires "use" property as "object" not others');var i=e.prefix||"",a=o.filter(function(t){return!0===e.use[t]});Object.entries(t).forEach(function(t){var e=n(t,2),o=e[0],s=e[1];return f(s)&&r._actions.set(""+i+o,{useKeys:a,action:s})})}},{key:"order",value:function(t){var e=this;h(Boolean(t)&&!s(t),'Orph.prototype.order requires argument as "array"');var r={};return(t||[].concat(i(this._actions.keys()))).forEach(function(t){r[t]=function(r){f(r.persist)&&r.persist(),e.dispatch(t,r)}}),r}},{key:"list",value:function(){var t={};return[].concat(i(this._actions.entries())).forEach(function(e){var r=n(e,2),i=r[0],a=r[1].useKeys;t[i]=a}),t}},{key:"attach",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h(!f(t.setState),"orph.attach must be passed react"),this._escapeState=function(){return t.state},this._use.props=this._makeUseCancelable(function(e,r){return r?t.props[e]:u(t.props[e])}),this._use.state=this._makeUseCancelable(function(e,r){return r?t.state[e]:u(t.state[e])}),this._use.render=this._makeUseCancelable(function(e,r){return t.setState(e,r)}),this._use.update=this._makeUseCancelable(function(e){return t.forceUpdate(e)}),t.state=e.inherit?this._existState():this._initialState}},{key:"_makeUseCancelable",value:function(t){var e=this;return function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return new Promise(function(r,i){return e._isAttached()?r(t.apply(void 0,n)):i({isDetached:!0})})}}},{key:"detach",value:function(){var t=this;this._preState=this._escapeState(),delete this._escapeState,a.forEach(function(e){return delete t._use[e]})}},{key:"_existState",value:function(){return this._preState||this._initialState}},{key:"_isAttached",value:function(){return f(this._escapeState)}},{key:"dispatch",value:function(t,e){h(!this._actions.has(t),"Orph.prototype.dispatch passed "+t+" as name that is not retisterd");var r=this._actions.get(t);return Promise.resolve(r.action(e,this._createUse(r.useKeys)))}},{key:"_createUse",value:function(t){var e=this,r={};return t.forEach(function(t){r[t]=e._use[t]}),r}},{key:"getLatestState",value:function(t,e){var r=this._isAttached()?this._escapeState()[t]:this._existState()[t];return e?r:u(r)}}]),t}()});
