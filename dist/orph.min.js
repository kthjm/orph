!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Orph=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},i=["props","state","render","update"],a=i.concat(["dispatch"]),s=Array.isArray,u=function e(r){return"object"!==(void 0===(o=r)?"undefined":t(o))||null===o?r:s(r)?r.map(function(t){return e(t)}):(n={},Object.keys(r).forEach(function(t){n[t]=e(r[t])}),n);var n,o},c=function(e){return"object"===(void 0===e?"undefined":t(e))&&!s(e)&&null!==e},f=function(t){return"function"==typeof t},h=function(t,e){if(t)throw new Error(e)};return function(){function t(r){var n=this;e(this,t),h(!c(r),'Orph.prototype.constructor requires argument as "object" not others'),this._actions=new Map,this._initialState=u(r),this._use={dispatch:function(t,e){return n.dispatch(t,e)}}}return r(t,[{key:"_fnToCancelable",value:function(t){var e=this;return function(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];return new Promise(function(r,o){return e._isAttached()?r(t.apply(void 0,n)):o({isDetached:!0})})}}},{key:"register",value:function(t,e){var r=this;h(!c(t),'Orph.prototype.register requires first argument as "object" not others'),h(!c(e),'Orph.prototype.register requires second argument as "object" not others'),h(!c(e.use),'Orph.prototype.register second argument requires "use" property as "object" not others');var o=e.use,i=Object.keys(o).filter(function(t){return-1!==a.indexOf(t)&&!0===o[t]}),s=e.prefix||"";Object.entries(t).forEach(function(t){var e=n(t,2),o=e[0],a=e[1];return f(a)&&r._actions.set(""+s+o,{useKeys:i,action:r._fnToCancelable(a)})})}},{key:"order",value:function(t){var e=this;h(Boolean(t)&&!s(t),'Orph.prototype.order requires argument as "array"');var r={};return(t||[].concat(o(this._actions.keys()))).forEach(function(t){r[t]=function(r){f(r.persist)&&r.persist(),e.dispatch(t,r)}}),r}},{key:"list",value:function(){var t={};return[].concat(o(this._actions.entries())).forEach(function(e){var r=n(e,2),o=r[0],i=r[1].useKeys;t[o]=i}),t}},{key:"attach",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h(!f(t.setState),"orph.attach must be passed react"),this._escapeState=function(){return t.state},[["props",function(e,r){return r?t.props[e]:u(t.props[e])}],["state",function(e,r){return r?t.state[e]:u(t.state[e])}],["render",function(e,r){return t.setState(e,r)}],["update",function(e){return t.forceUpdate(e)}]].forEach(function(t){var r=n(t,2),o=r[0],i=r[1];e._use[o]=e._fnToCancelable(i)}),t.state=r.inherit?this._existState():this._initialState}},{key:"detach",value:function(){var t=this;this._preState=this._escapeState(),delete this._escapeState,i.forEach(function(e){return delete t._use[e]})}},{key:"_existState",value:function(){return this._preState||this._initialState}},{key:"_isAttached",value:function(){return f(this._escapeState)}},{key:"dispatch",value:function(t,e){h(!this._actions.has(t),"Orph.prototype.dispatch passed "+t+" as name that is not retisterd");var r=this._actions.get(t);return r.action(e,this._createUse(r.useKeys))}},{key:"_createUse",value:function(t){var e=this,r={};return t.forEach(function(t){r[t]=e._use[t]}),r}},{key:"getLatestState",value:function(t,e){var r=this._isAttached()?this._escapeState()[t]:this._existState()[t];return e?r:u(r)}}]),t}()});
