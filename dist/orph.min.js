!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Orph=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},o=Array.isArray,a=Object.assign,s=function(){function s(t){var r=this;e(this,s),this.active=!1,this._listeners=new Map,o(t)&&t.forEach(function(t){return r.add.apply(r,i(t))})}return r(s,[{key:"add",value:function(t,e,r){u(t,"string",'orph.add argument "name"'),u(e,"function",'orph.add argument "listener"'),r=r||{};var n=this._HoRender(r.states),i=this._HoDispatch(r.dispatches);this._listeners.set(t,{listener:e,render:n,dispatch:i,states:r.states,dispatches:r.dispatches})}},{key:"list",value:function(){var t={};return[].concat(i(this._listeners.entries())).forEach(function(e){var r=n(e,2),i=r[0],o=r[1];t[i]={states:o.states,dispatches:o.dispatches}}),t}},{key:"attach",value:function(t){u(t.setState,"function","react.setState"),this._setState=t.setState.bind(t),this.props=function(){return a({},t.props)},this.state=function(){return a({},t.state)},this.active=!0}},{key:"detach",value:function(){this.active=!1}},{key:"create",value:function(t){var e=this;return u(t,"string",'orph.create argument "name"'),this._throwIfNotActive("create"),function(r){e._exec(t,r)}}},{key:"dispatch",value:function(t,e){return u(t,"string",'orph.dispatch argument "name"'),this._throwIfNotActive("dispatch"),this._exec(t,e)}},{key:"_HoDispatch",value:function(t){var e=this;return o(t)?function(r,n){if(-1===t.indexOf(r))throw new Error("methods.dispatch touches dispatchName that is not registerd");return e._exec(r,n)}:function(t,r){return e._exec(t,r)}}},{key:"_exec",value:function(t,e){var r=this;return e&&"function"==typeof e.persist&&e.persist(),Promise.resolve().then(function(){r._throwIfNotActive("_exec");var n=r._listeners.get(t);if(n){var i=n.listener,o=n.render,a=n.dispatch,s=r.state,u=r.props;return i(e,{render:o,dispatch:a,state:s,props:u})}throw new Error("methods.dispatch name is not added")})}},{key:"_HoRender",value:function(e){var r=this;return o(e)?function(n){if("object"===(void 0===n?"undefined":t(n))){if(Object.keys(n).filter(function(t){return!(-1!==e.indexOf(t))}).length)throw new Error("methods.render touches stateName that is not registerd")}return r._render(n)}:function(t){return r._render(t)}}},{key:"_render",value:function(t){if(this.active){var e=this.state();this._setState(a(e,t))}}},{key:"_throwIfNotActive",value:function(t){if(!this.active)throw new Error("not active but "+t+"()")}}]),s}(),u=function(e,r,n){if(!e)throw new Error(n+" is undefined | false | null");if((void 0===e?"undefined":t(e))!==r)throw new TypeError(n+" is not "+r+" but "+(void 0===e?"undefined":t(e)))};return s});
